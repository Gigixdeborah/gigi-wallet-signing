<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Solana Wallet Multi-Wallet Live Signing</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Solana Wallet Adapter UMD bundle (core, wallets, UI) -->
  <script src="https://unpkg.com/@solana/wallet-adapter-wallets@0.21.12/dist/umd/index.min.js"></script>
  <script src="https://unpkg.com/@solana/wallet-adapter-base@0.16.14/dist/umd/index.min.js"></script>
  <script src="https://unpkg.com/@solana/wallet-adapter-react-ui@0.20.12/dist/umd/index.min.js"></script>
  <script src="https://unpkg.com/@solana/wallet-adapter-react@0.21.13/dist/umd/index.min.js"></script>
  <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.js"></script>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #f9f9f9; margin: 40px; }
    .container { max-width: 540px; margin: auto; background: #fff; padding: 32px; border-radius: 12px; box-shadow: 0 2px 10px #0001; }
    input, button { padding: 10px; margin: 8px 0; width: 100%; }
    #signature { word-break: break-all; background: #f0f0f0; padding: 8px; border-radius: 4px; }
    .wallet-select { margin-bottom: 16px; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/javascript">
    const { useState, useEffect } = React;
    const {
      PhantomWalletAdapter,
      SolflareWalletAdapter,
      TorusWalletAdapter,
      BackpackWalletAdapter,
      LedgerWalletAdapter,
      CoinbaseWalletAdapter,
      MathWalletAdapter,
      SolletExtensionWalletAdapter,
      SolletWalletAdapter,
      // Add more as needed
    } = solanaWalletAdapterWallets;

    function App() {
      const [wallets, setWallets] = useState([]);
      const [selectedWalletIndex, setSelectedWalletIndex] = useState(null);
      const [adapter, setAdapter] = useState(null);
      const [publicKey, setPublicKey] = useState(null);
      const [connecting, setConnecting] = useState(false);
      const [message, setMessage] = useState("Hello Solana!");
      const [signature, setSignature] = useState("");
      const [error, setError] = useState("");

      useEffect(() => {
        // List of supported wallet adapters
        setWallets([
          new PhantomWalletAdapter(),
          new SolflareWalletAdapter(),
          new TorusWalletAdapter(),
          new BackpackWalletAdapter(),
          new LedgerWalletAdapter(),
          new CoinbaseWalletAdapter(),
          new MathWalletAdapter(),
          new SolletExtensionWalletAdapter(),
          new SolletWalletAdapter(),
        ]);
      }, []);

      useEffect(() => {
        if (selectedWalletIndex !== null) {
          const wallet = wallets[selectedWalletIndex];
          setAdapter(wallet);
        }
      }, [selectedWalletIndex, wallets]);

      // Connect wallet
      const connectWallet = async () => {
        setError("");
        setSignature("");
        if (!adapter) return setError("Select a wallet first.");
        if (adapter.connected) {
          setPublicKey(adapter.publicKey?.toString());
          return;
        }
        setConnecting(true);
        try {
          await adapter.connect();
          setPublicKey(adapter.publicKey?.toString());
        } catch (e) {
          setError("Connection error: " + (e.message || e));
        }
        setConnecting(false);
      };

      // Disconnect wallet
      const disconnectWallet = async () => {
        if (adapter && adapter.disconnect) {
          await adapter.disconnect();
        }
        setPublicKey(null);
        setSignature("");
        setError("");
      };

      // Sign message
      const signMessage = async (e) => {
        e.preventDefault();
        setError("");
        setSignature("");
        if (!adapter || !adapter.connected) {
          return setError("Connect your wallet first.");
        }
        try {
          const encoder = new TextEncoder();
          const encoded = encoder.encode(message);
          const signed = await adapter.signMessage(encoded, 'utf8');
          const base64 = btoa(String.fromCharCode(...signed));
          setSignature(base64);
        } catch (e) {
          setError("Signing error: " + (e.message || e));
        }
      };

      return (
        React.createElement('div', { className: 'container' },
          React.createElement('h2', null, 'Solana Multi-Wallet Live Signing'),
          React.createElement('div', { className: 'wallet-select' },
            React.createElement('label', null, 'Select Wallet:'),
            React.createElement('select', {
              value: selectedWalletIndex !== null ? selectedWalletIndex : "",
              onChange: e => {
                setSelectedWalletIndex(e.target.value !== "" ? Number(e.target.value) : null);
                setPublicKey(null);
                setSignature("");
                setError("");
                if (adapter && adapter.disconnect) adapter.disconnect();
              }
            },
              React.createElement('option', { value: "" }, "-- Choose a Wallet --"),
              wallets.map((w, i) =>
                React.createElement('option', { key: i, value: i }, w.name)
              )
            ),
            selectedWalletIndex !== null && React.createElement('button', {
              style: { marginLeft: 8, padding: "10px 20px" },
              onClick: connectWallet,
              disabled: connecting || (adapter && adapter.connected)
            }, adapter && adapter.connected ? "Connected" : connecting ? "Connecting..." : "Connect"),
            adapter && adapter.connected && React.createElement('button', {
              style: { marginLeft: 8, padding: "10px 20px", background: "#e55", color: "#fff", border: "none" },
              onClick: disconnectWallet
            }, "Disconnect"),
          ),
          publicKey && React.createElement('div', { style: { marginBottom: 12 } },
            React.createElement('strong', null, "Wallet Address: "),
            publicKey
          ),
          React.createElement('form', { id: 'signForm', onSubmit: signMessage },
            React.createElement('label', { htmlFor: "message" }, "Message to Sign:"),
            React.createElement('input', {
              id: "message",
              type: "text",
              value: message,
              required: true,
              onChange: e => setMessage(e.target.value)
            }),
            React.createElement('button', { type: "submit", disabled: !publicKey }, "Sign Message")
          ),
          signature && React.createElement('div', { id: "signatureSection", style: { marginTop: 18 } },
            React.createElement('h4', null, "Signature (base64):"),
            React.createElement('div', { id: "signature" }, signature)
          ),
          error && React.createElement('div', { id: "error", style: { color: "red", marginTop: 10 } }, error)
        )
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(React.createElement(App));
  </script>
</body>
</html>
