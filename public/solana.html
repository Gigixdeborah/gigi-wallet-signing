<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Solana Phantom Wallet Signing | Modern Adapter</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Fonts & Theme -->
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
  <!-- React and ReactDOM UMD -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <!-- Solana/web3 and Wallet Adapters UMD -->
  <script src="https://unpkg.com/@solana/web3.js@1.93.0/lib/index.iife.js"></script>
  <!-- Wallet Adapter Core & React -->
  <script src="https://unpkg.com/@solana/wallet-adapter-base@0.11.21/dist/umd/index.min.js"></script>
  <script src="https://unpkg.com/@solana/wallet-adapter-react@0.18.12/dist/umd/index.min.js"></script>
  <script src="https://unpkg.com/@solana/wallet-adapter-wallets@0.24.13/dist/umd/index.min.js"></script>
  <script src="https://unpkg.com/@solana/wallet-adapter-react-ui@0.9.18/dist/umd/index.min.js"></script>
  <!-- Phantom Wallet Adapter UMD -->
  <script src="https://unpkg.com/@solana/wallet-adapter-phantom@0.21.13/dist/umd/index.min.js"></script>
  <!-- Wallet Adapter Styles -->
  <link rel="stylesheet" href="https://unpkg.com/@solana/wallet-adapter-react-ui@0.9.18/styles.css">
  <style>
    body {
      background: #09092b;
      font-family: 'Orbitron', 'Inter', Arial, sans-serif;
      color: #e0e0ff;
      margin: 0;
      min-height: 100vh;
    }
    .container {
      max-width: 440px;
      margin: 90px auto 0 auto;
      padding: 34px 30px 28px 30px;
      background: rgba(30,30,60,0.95);
      box-shadow: 0 0 40px 7px #00d4ff44, 0 0 0 2px #ff408144;
      border-radius: 17px;
      border: 2.5px solid #00d4ff;
      position: relative;
      z-index: 1;
      text-align: center;
    }
    h2 {
      font-weight: 700;
      color: #00d4ff;
      font-size: 2em;
      letter-spacing: 2px;
      text-shadow: 0 0 10px #00d4ff, 0 0 18px #ff4081;
      margin-bottom: 28px;
    }
    .short {
      max-width: 200px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      display: inline-block;
      vertical-align: bottom;
    }
    .user-banner {
      color: #fff;
      background: #00d4ff3b;
      border-radius: 7px;
      padding: 8px 0 6px 0;
      margin-bottom: 12px;
      font-size: 1.03em;
      font-family: monospace;
      border: 1.5px solid #00d4ff77;
      box-shadow: 0 0 8px #00d4ff22;
    }
    form {
      margin: 0 auto 0 auto;
      width: 100%;
    }
    .input-row label {
      display: block;
      font-weight: 700;
      margin-bottom: 7px;
      color: #e0e0ff;
      text-align: left;
      letter-spacing: 0.02em;
      text-shadow: 0 0 4px #00d4ff;
    }
    .input-row input {
      width: 100%;
      padding: 10px 12px;
      border-radius: 8px;
      border: 1.7px solid #00d4ff80;
      background: #191940;
      color: #90f0ff;
      font-size: 1.07em;
      font-family: monospace;
      margin-bottom: 11px;
      box-shadow: 0 0 8px #00d4ff22;
    }
    .wallet-multibtn {
      margin: 0 auto 16px auto;
      display: flex;
      justify-content: center;
    }
    .result-row, .sig-row {
      margin: 17px 0 0 0;
      padding: 10px 12px;
      border-radius: 8px;
      background: #182026;
      font-family: monospace;
      font-size: 1em;
      word-break: break-all;
      color: #00d4ff;
      border: 1.2px solid #00d4ff55;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }
    .sig-row {
      background: #ff40811a;
      border: 1.5px solid #ff408180;
      color: #ff4081;
    }
    .copy-btn {
      margin-left: 6px;
      padding: 3px 12px;
      font-size: 1em;
      border: 1.5px solid #00d4ff;
      background: rgba(0,212,255,0.09);
      border-radius: 6px;
      color: #fff;
      cursor: pointer;
      transition: background 0.2s, border-color 0.2s;
      font-family: 'Orbitron', Arial, sans-serif;
      text-shadow: 0 0 4px #00d4ff;
    }
    .copy-btn:hover {
      background: #ff4081;
      border-color: #ff4081;
      color: #fff;
    }
    .msg-error {
      color: #db2777;
      background: #ffe3e333;
      padding: 10px 14px;
      border-radius: 8px;
      margin-top: 13px;
      font-weight: 600;
      border: 1.5px solid #fecdd3;
      box-shadow: 0 0 10px #ff408144;
      letter-spacing: 0.01em;
      font-family: 'Orbitron', Arial, sans-serif;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Solana Phantom Wallet Signing</h2>
    <div id="solana-root"></div>
  </div>
  <script>
    // Utility for query params
    function getQueryParams() {
      const params = {};
      const search = window.location.search;
      if (search) {
        search.substr(1).split("&").forEach(pair => {
          const [k, v] = pair.split("=");
          params[decodeURIComponent(k)] = decodeURIComponent(v || "");
        });
      }
      return params;
    }

    // UMD global shims for wallet adapter React context
    const { useMemo, useState, useEffect, useCallback } = React;
    const { ConnectionProvider, WalletProvider, useWallet } = window['walletAdapterReact'];
    const { WalletAdapterNetwork } = window['walletAdapterBase'];
    const { PhantomWalletAdapter } = window['walletAdapterPhantom'];
    const { WalletMultiButton } = window['walletAdapterReactUI'];

    function SolanaDapp() {
      const params = getQueryParams();
      // Setup Solana endpoint (mainnet)
      const endpoint = React.useMemo(
        () => 'https://api.mainnet-beta.solana.com',
        []
      );
      // Only Phantom in wallet list (add more if desired)
      const wallets = React.useMemo(
        () => [new PhantomWalletAdapter()],
        []
      );
      return React.createElement(ConnectionProvider, { endpoint },
        React.createElement(WalletProvider, { wallets, autoConnect: false },
          React.createElement(WalletUI, { params })
        )
      );
    }

    function WalletUI({ params }) {
      const { publicKey, signMessage, connected } = useWallet();
      const [message, setMessage] = useState(() => {
        if (params.to && params.amount) return `Send ${params.amount} SOL to ${params.to}`;
        if (params.to) return `Send SOL to ${params.to}`;
        if (params.amount) return `Send ${params.amount} SOL`;
        return "Hello Solana!";
      });
      const [signature, setSignature] = useState("");
      const [error, setError] = useState("");
      const [copied, setCopied] = useState({address: false, signature: false});

      const handleCopy = (type, value) => {
        navigator.clipboard.writeText(value);
        setCopied(prev => ({...prev, [type]: true}));
        setTimeout(() => setCopied(prev => ({...prev, [type]: false})), 1200);
      };

      const handleSign = async (e) => {
        e.preventDefault();
        setError("");
        setSignature("");
        if (!connected || !signMessage) {
          setError("Connect your Phantom wallet first.");
          return;
        }
        try {
          const encoder = new TextEncoder();
          const encoded = encoder.encode(message);
          const signed = await signMessage(encoded);
          const base64 = btoa(String.fromCharCode(...signed));
          setSignature(base64);
        } catch (e) {
          setError("Signing error: " + (e.message || e));
        }
      };

      return React.createElement(React.Fragment, null,
        params.user_id && React.createElement('div', {className: "user-banner"}, `User: ${params.user_id}`),
        React.createElement('div', { className: "wallet-multibtn" },
          React.createElement(WalletMultiButton, { style: { fontWeight: 800, fontSize: "1.1em" } })
        ),
        publicKey && React.createElement('div', { className: "result-row", style: {marginTop: 7}},
          React.createElement('span', {className: 'short', title: publicKey.toString()}, publicKey.toString().slice(0, 8) + "..." + publicKey.toString().slice(-6)),
          React.createElement('button', {
            className: "copy-btn",
            onClick: () => handleCopy('address', publicKey.toString())
          }, copied.address ? "Copied!" : "Copy")
        ),
        React.createElement('form', { onSubmit: handleSign, autoComplete: "off" },
          React.createElement('div', { className: "input-row" },
            React.createElement('label', { htmlFor: "message" }, "Message to Sign"),
            React.createElement('input', {
              id: "message",
              type: "text",
              value: message,
              maxLength: 140,
              required: true,
              onChange: e => setMessage(e.target.value),
              autoComplete: "off"
            })
          ),
          React.createElement('button', {
            type: "submit",
            disabled: !connected,
            style: { width: "100%", padding: "13px 0", fontWeight: 700, fontSize: "1.18em", borderRadius: "9px",
                     background: "linear-gradient(90deg,#00d4ff 0%,#ff4081 100%)", color: "#fff", border: "none",
                     cursor: "pointer", marginTop: 3, marginBottom: 6 }
          }, "Sign Message")
        ),
        signature && React.createElement('div', { className: "sig-row" },
          React.createElement('span', {className: 'short', title: signature}, signature.slice(0, 16) + "..." + signature.slice(-10)),
          React.createElement('button', {
            className: "copy-btn",
            onClick: () => handleCopy('signature', signature)
          }, copied.signature ? "Copied!" : "Copy")
        ),
        error && React.createElement('div', { className: "msg-error" }, error)
      );
    }

    ReactDOM.createRoot(document.getElementById('solana-root')).render(React.createElement(SolanaDapp));
  </script>
</body>
</html>
