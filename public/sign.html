<!DOCTYPE html>
<html>
  <head>
    <title>Sign Transaction</title>
    <script src="https://unpkg.com/@tonconnect/sdk@latest/dist/tonconnect-sdk.min.js"></script>
  </head>
  <body>
    <h1>Sign Transaction with Your Wallet</h1>
    <div id="wallet-status">ğŸ”„ Connecting...</div>
    <button id="connect-btn">ğŸ”— Connect TON Wallet</button>
    <button id="sign-btn" disabled>âœï¸ Sign Transaction</button>

    <script>
      const tonConnect = new TON_CONNECT.TonConnect({
        manifestUrl: "https://gigi-wallet-signing.onrender.com/tonconnect-manifest.json"
      });

      const connectBtn = document.getElementById("connect-btn");
      const signBtn = document.getElementById("sign-btn");
      const walletStatus = document.getElementById("wallet-status");

      async function init() {
        const connectedWallet = await tonConnect.restoreConnection();
        if (connectedWallet) {
          walletStatus.innerText = "âœ… Wallet Connected";
          signBtn.disabled = false;
        } else {
          walletStatus.innerText = "âŒ No wallet connected";
        }
      }

      connectBtn.onclick = async () => {
        await tonConnect.connectWallet();
        walletStatus.innerText = "âœ… Wallet Connected";
        signBtn.disabled = false;
      };

      signBtn.onclick = async () => {
        const urlParams = new URLSearchParams(window.location.search);
        const amount = urlParams.get("amount");
        const to = urlParams.get("to");

        if (!amount || !to) {
          alert("Missing amount or recipient address.");
          return;
        }

        const transaction = {
          validUntil: Math.floor(Date.now() / 1000) + 600, // 10 minutes
          messages: [
            {
              address: to,
              amount: amount,
            },
          ],
        };

        try {
          await tonConnect.sendTransaction(transaction);
          alert("âœ… Transaction sent! Check your wallet.");
        } catch (e) {
          console.error(e);
          alert("âŒ Failed to send transaction.");
        }
      };

      init();
    </script>
  </body>
</html>
