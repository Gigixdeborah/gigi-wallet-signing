<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sign Transaction</title>
  <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
</head>
<body>
  <h1>🔐 Sign Transaction with Your Wallet</h1>
  <div id="wallet"></div>
  <br />
  <button id="signButton" disabled>✍️ Sign Transaction</button>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const amount = urlParams.get("amount");
    const toAddress = urlParams.get("to");

    const tonConnectUI = new TON_CONNECT.UI.TonConnectUI({
      manifestUrl: "https://gigi-wallet-signing.onrender.com/tonconnect-manifest.json",
      buttonRootId: "wallet"
    });

    document.getElementById("signButton").addEventListener("click", async () => {
      const connectedWallet = await tonConnectUI.connectedWallet;
      if (!connectedWallet) return alert("Wallet not connected");

      const transaction = {
        validUntil: Math.floor(Date.now() / 1000) + 600, // 10 minutes
        messages: [
          {
            address: toAddress,
            amount: amount,
          }
        ]
      };

      try {
        await tonConnectUI.sendTransaction(transaction);
        alert("✅ Transaction signed!");
      } catch (err) {
        alert("❌ Transaction rejected or failed.");
      }
    });

    tonConnectUI.onStatusChange(wallet => {
      document.getElementById("signButton").disabled = !wallet;
    });
  </script>
</body>
</html>
